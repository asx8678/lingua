---
import MainLayout from "../layouts/MainLayout.astro";
import CTASection from "../components/CTASection.astro";
import TestimonialCard from "../components/TestimonialCard.astro";
import {
  BRAND_NAME,
  CTA_PRIMARY_HREF,
  CTA_PRIMARY_LABEL,
  SITE_URL,
  generateBreadcrumbSchema,
} from "../config/site";
import testimonials from "../data/testimonials.json";

const title = `Opinie kursantów | ${BRAND_NAME}`;
const description =
  "Poznaj opinie kursantów Lingua Legionowo. Sprawdź, co mówią o zajęciach językowych i matematyce - stacjonarnie w Legionowie i online. Oceny, wrażenia i rekomendacje.";

const highlights = [
  "Szybkie przejście od teorii do mówienia.",
  "Regularne podsumowania i jasny plan nauki.",
  "Elastyczne terminy bez dojazdów.",
  "Wsparcie lektora między spotkaniami.",
];

const breadcrumbSchema = generateBreadcrumbSchema([
  { name: "Strona główna", url: "/" },
  { name: "Opinie" },
]);

const reviewCount = testimonials.length;
const reviewAverage = reviewCount
  ? (testimonials.reduce((sum, item) => sum + item.rating, 0) / reviewCount).toFixed(1)
  : "0";

const reviewSchema = {
  "@context": "https://schema.org",
  "@type": "LocalBusiness",
  "@id": `${SITE_URL}/#organization`,
  name: BRAND_NAME,
  aggregateRating: {
    "@type": "AggregateRating",
    ratingValue: reviewAverage,
    reviewCount: reviewCount,
    bestRating: 5,
    worstRating: 1,
  },
  review: testimonials.map((t) => ({
    "@type": "Review",
    author: { "@type": "Person", name: t.name },
    reviewRating: { "@type": "Rating", ratingValue: t.rating, bestRating: 5 },
    reviewBody: t.text,
    datePublished: t.date,
  })),
};
---

<MainLayout
  title={title}
  description={description}
  canonical="/opinie"
  structuredData={[breadcrumbSchema, reviewSchema]}
>
  <section class="hero-bg section-hero">
    <div class="container-site">
      <div class="grid gap-10 lg:grid-cols-2 lg:items-start">
        <div>
          <span class="kicker">Opinie</span>
          <h1 class="mt-6">Opinie kursantów Lingua Legionowo</h1>
          <p class="mt-6 max-w-2xl text-lg">
            Poniżej znajdziesz wybrane opinie osób, które uczą się z nami stacjonarnie lub online.
          </p>
          <div class="mt-8">
            <a class="btn btn-primary" href="/cennik">Sprawdź cennik</a>
          </div>
        </div>

        <div class="card p-6">
          <h2 class="text-lg font-bold tracking-tight">Co najczęściej doceniają kursanci</h2>
          <ul class="mt-4 list-disc space-y-2 pl-5 text-sm text-slate-600">
            {highlights.map((item) => <li>{item}</li>)}
          </ul>
          <div class="mt-6">
            <a class="btn btn-ghost" href="/cennik">Sprawdź cennik</a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="section">
    <div class="container-site">
      <h2>Opinie kursantów</h2>
      <p class="mt-4 max-w-3xl">
        Każda opinia została dodana za zgodą kursanta. Jeśli chcesz podzielić się wrażeniami, napisz
        do nas.
      </p>

      <div class="mt-8 grid gap-6 md:grid-cols-2">
        {
          testimonials.map((item) => (
            <TestimonialCard testimonial={item} />
          ))
        }
      </div>
    </div>
  </section>

  <CTASection
    title="Chcesz sprawdzić, czy to dla Ciebie?"
    description="Napisz, jaki masz poziom i cel — zaproponujemy najlepszy format i cenę."
  />
</MainLayout>
