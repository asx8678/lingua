---
import MainLayout from "../../layouts/MainLayout.astro";
import { getCollection } from "astro:content";
import { BRAND_NAME, SITE_URL } from "../../config/site";

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  return posts
    .filter((post) => !post.data.draft)
    .map((post) => ({ params: { slug: post.slug }, props: { post } }));
}

const { post } = Astro.props;
const { Content } = await post.render();

const title = `${post.data.title} | ${BRAND_NAME}`;
const description = post.data.description;

const formattedDate = new Intl.DateTimeFormat("pl-PL", { dateStyle: "medium" }).format(post.data.pubDate);
const canonicalUrl = new URL(Astro.url.pathname, SITE_URL).toString();

const articleJsonLd = {
  "@context": "https://schema.org",
  "@type": "Article",
  headline: post.data.title,
  description,
  datePublished: post.data.pubDate.toISOString(),
  dateModified: (post.data.updatedDate ?? post.data.pubDate).toISOString(),
  author: {
    "@type": "Organization",
    name: BRAND_NAME,
  },
  publisher: {
    "@type": "Organization",
    name: BRAND_NAME,
  },
  mainEntityOfPage: canonicalUrl,
};
---

<MainLayout title={title} description={description} ogType="article" structuredData={[articleJsonLd]}>
  <article class="section">
    <div class="container-site">
      <div class="text-xs font-bold uppercase tracking-widest text-slate-500">Blog · {formattedDate}</div>
      <div class="prose prose-slate mt-6 max-w-none">
        <Content />
      </div>
      <div class="mt-10 flex flex-wrap gap-3">
        <a class="btn btn-secondary" href="/blog">Wróć do bloga</a>
        <a class="btn btn-primary" href="/kontakt">Umów lekcję próbną</a>
      </div>
      <p class="mt-4 text-sm text-slate-500">
        Sprawdź także
        <a class="font-bold text-primary no-underline hover:underline" href="/cennik">cennik</a>.
      </p>
    </div>
  </article>
</MainLayout>
