---
import MainLayout from "../layouts/MainLayout.astro";
import CTASection from "../components/CTASection.astro";
import MonthlyCalculator from "../components/MonthlyCalculator.astro";
import PricingTable from "../components/PricingTable.astro";
import { PRICING_DATA, formatPLN } from "../data/pricing";
import {
  BRAND_NAME,
  CTA_PRIMARY_HREF,
  CTA_PRIMARY_LABEL,
  CTA_PRIMARY_REL,
  CTA_PRIMARY_TARGET,
  OTHER_LANG_PRICE_1ON1_FROM,
  OTHER_LANG_PRICE_GROUP_FROM,
  getEnrollmentMessage,
  generateBreadcrumbSchema,
} from "../config/site";

const title = `Cennik – kursy językowe i matematyka w Legionowie | ${BRAND_NAME}`;
const description =
  "Sprawdź ceny kursów angielskiego i matematyki w Legionowie. Lekcje stacjonarne i online, 1:1, mini-grupy i kursy grupowe.";

const steps = [
  "Podaj poziom i cel nauki",
  "Wybierz preferowany format (1:1 / mini-grupa)",
  "Dostaniesz propozycję planu i cenę",
];

const packageColumns = [
  "Czas lekcji",
  "Liczba osób",
  "Cena / spotkanie",
  "Pakiet 10 spotkań / osoba",
  "Szacunkowo / mies. (4 spotkania)",
];

const packageRows = PRICING_DATA.packages.flatMap((plan) => {
  const persons = Object.keys(plan.pricePerPerson)
    .map((value) => Number(value))
    .sort((a, b) => a - b);
  return persons.map((count) => {
    const total = plan.pricePerPerson[count];
    const perSession = total / plan.baseSessions;
    const perMonth = perSession * 4;
    return [
      `${plan.minutes} min`,
      `${count} os.`,
      formatPLN(perSession),
      `${formatPLN(total)} / osoba`,
      formatPLN(perMonth),
    ];
  });
});

const courseColumns = [
  "Kurs grupowy",
  "Czas spotkania",
  "Liczba spotkań",
  "Cena / osoba",
  "Cena / spotkanie",
  "Min. grupa",
];

const courseRows = PRICING_DATA.courses.map((course) => {
  const perSession = course.price / course.sessions;
  return [
    course.label,
    `${course.minutes} min`,
    `${course.sessions}`,
    `${formatPLN(course.price)} / osoba`,
    formatPLN(perSession),
    `od ${course.minPersons} osób`,
  ];
});

const packageFootnote =
  "Szacunek miesięczny zakłada 4 tygodnie nauki i odnosi się do pakietów 10 spotkań.";
const courseFootnote = "Kursy grupowe mają stałą liczbę spotkań i cenę za osobę.";
const enrollmentMessage = getEnrollmentMessage();

const hasOtherLangPricing =
  typeof OTHER_LANG_PRICE_1ON1_FROM === "number" ||
  typeof OTHER_LANG_PRICE_GROUP_FROM === "number";
const otherLangPricing = [
  ...(typeof OTHER_LANG_PRICE_1ON1_FROM === "number"
    ? [{ label: "Lekcje 1:1 od", value: formatPLN(OTHER_LANG_PRICE_1ON1_FROM) }]
    : []),
  ...(typeof OTHER_LANG_PRICE_GROUP_FROM === "number"
    ? [{ label: "Mini-grupy od", value: formatPLN(OTHER_LANG_PRICE_GROUP_FROM) }]
    : []),
];

const faq = [
  {
    question: "Jak liczymy ceny w tabeli i kalkulatorze?",
    answer:
      "Pakiety bazują na 10 spotkaniach, a kalkulator miesięczny przyjmuje 4 tygodnie w miesiącu. Kursy grupowe mają stałą liczbę spotkań i cenę / osobę.",
  },
  {
    question: "Jak rozliczane są kursy grupowe?",
    answer:
      "Kursy mają stałą liczbę spotkań i cenę za osobę zgodnie z cennikiem (30×90 lub 56×60/90 min). Minimalna liczba osób wynika z cennika.",
  },
  {
    question: "Czy matematyka kosztuje tyle samo co angielski?",
    answer: "Tak, matematyka jest wyceniana według tych samych stawek co angielski.",
  },
];

const faqJsonLd = {
  "@context": "https://schema.org",
  "@type": "FAQPage",
  mainEntity: faq.map((item) => ({
    "@type": "Question",
    name: item.question,
    acceptedAnswer: {
      "@type": "Answer",
      text: item.answer,
    },
  })),
};

const breadcrumbSchema = generateBreadcrumbSchema([
  { name: "Strona główna", url: "/" },
  { name: "Cennik" },
]);

// Tailwind class constants
const btnBase = "inline-flex items-center justify-center gap-2 rounded-full px-6 py-3 text-sm font-bold transition-all duration-200 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary";
const btnPrimary = `${btnBase} bg-primary text-white shadow-md hover:bg-primary-700 hover:shadow-lg hover:-translate-y-0.5 active:translate-y-0 active:shadow-md`;
const btnSecondary = `${btnBase} border border-slate-200 bg-white text-slate-700 shadow-sm hover:border-primary/30 hover:text-primary hover:shadow-md hover:-translate-y-0.5 active:translate-y-0`;
const btnGhost = `${btnBase} bg-transparent text-slate-700 hover:bg-slate-100`;
const card = "rounded-2xl border border-slate-200/80 bg-white shadow-sm transition-shadow hover:shadow-md";
const kicker = "inline-block rounded-full bg-primary/10 px-4 py-1.5 text-xs font-bold uppercase tracking-widest text-primary";
const notice = "rounded-xl border border-primary/20 bg-primary/5 p-4 text-primary";
---

<MainLayout
  title={title}
  description={description}
  canonical="/cennik"
  structuredData={[faqJsonLd, breadcrumbSchema]}
>
  <section class="bg-hero-gradient">
    <div class="mx-auto w-full max-w-7xl px-6 py-16 sm:py-20">
      <div class="grid gap-10 lg:grid-cols-2 lg:items-center">
        <div>
          <span class={kicker}>Cennik</span>
          <h1 class="mt-6">Cennik zajęć językowych i matematyki w Legionowie</h1>
          <p class="mt-6 max-w-2xl text-lg">
            Cena zależy od formatu zajęć (stacjonarnie/online), długości spotkań i częstotliwości.
            Poniżej znajdziesz orientacyjne warianty, a szczegóły ustalamy po krótkiej rozmowie.
          </p>
          <p class="mt-4 text-xs font-semibold uppercase tracking-widest text-slate-500">
            Cennik aktualny na rok 2025/2026
          </p>
          <p class="mt-4 text-sm text-slate-600">Matematyka ma takie same stawki jak angielski.</p>
          {
            hasOtherLangPricing ? (
              <div class="mt-4 grid gap-3 rounded-2xl border border-slate-200 bg-slate-50 p-4 text-sm text-slate-600 sm:grid-cols-2">
                {otherLangPricing.map((item) => (
                  <div>
                    <div class="text-xs font-bold uppercase tracking-widest text-slate-500">
                      {item.label}
                    </div>
                    <div class="mt-2 text-lg font-extrabold text-slate-900">{item.value}</div>
                  </div>
                ))}
              </div>
            ) : (
              <p class="mt-2 text-sm text-slate-600">
                Pozostałe języki: wycena indywidualna — zależna od lektora i formy zajęć.
              </p>
            )
          }
          <div class="mt-8 flex flex-wrap gap-3">
            <a class={btnSecondary} href="/cennik-lingua.pdf" download>
              <svg class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                <path
                  fill-rule="evenodd"
                  d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z"
                  clip-rule="evenodd"></path>
              </svg>
              Pobierz cennik (PDF)
            </a>
          </div>
          <div class={`mt-6 ${notice} text-sm`}>
            {enrollmentMessage}
          </div>
        </div>

        <div class={`${card} p-6 sm:p-8`}>
          <h2 class="text-xl font-extrabold tracking-tight">Jak uzyskać dokładną wycenę</h2>
          <ol class="mt-6 space-y-4 text-sm text-slate-600">
            {steps.map((step, index) => (
              <li class="flex items-start gap-3">
                <span class="flex h-6 w-6 flex-shrink-0 items-center justify-center rounded-full bg-primary/10 text-xs font-bold text-primary">
                  {index + 1}
                </span>
                <span class="pt-0.5">{step}</span>
              </li>
            ))}
          </ol>
          <div class="mt-8">
            <a
              class={`${btnPrimary} w-full sm:w-auto`}
              href={CTA_PRIMARY_HREF}
              target={CTA_PRIMARY_TARGET}
              rel={CTA_PRIMARY_REL}
              data-track="cta_primary"
              data-track-label={CTA_PRIMARY_LABEL}
            >
              {CTA_PRIMARY_LABEL}
            </a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="py-16 lg:py-24">
    <div class="mx-auto w-full max-w-7xl px-6">
      <h2>Jasne ceny za lekcje i pakiety</h2>
      <p class="mt-4 max-w-3xl">
        W tabelach znajdziesz ceny za spotkanie, pakiet 10 spotkań oraz szacunkowy koszt miesięczny.
        Kalkulator obok pozwala szybko policzyć wariant dopasowany do Twojego grafiku.
      </p>

      <div class="mt-10 grid gap-8 lg:grid-cols-[minmax(0,1fr)_minmax(0,0.85fr)] lg:items-start">
        <div class="space-y-6">
          <PricingTable
            title="Pakiety indywidualne i mini-grupy"
            subtitle="Ceny / osoba dla angielskiego i matematyki."
            columns={packageColumns}
            rows={packageRows}
            footnote={packageFootnote}
          />
          <PricingTable
            title="Kursy grupowe"
            subtitle="Stałe programy grupowe z ustaloną liczbą spotkań."
            columns={courseColumns}
            rows={courseRows}
            footnote={courseFootnote}
          />
        </div>
        <MonthlyCalculator />
      </div>

      <div class="mt-8">
        <a class={btnSecondary} href="/cennik-lingua.pdf" download>
          <svg class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
            <path
              fill-rule="evenodd"
              d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z"
              clip-rule="evenodd"></path>
          </svg>
          Pobierz pełny cennik (PDF)
        </a>
      </div>
    </div>
  </section>

  <section class="py-16 lg:py-24 bg-slate-50">
    <div class="mx-auto w-full max-w-7xl px-6">
      <div class={`${card} mx-auto max-w-xl p-6 text-center`}>
        <div class="mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-primary/10">
          <svg class="h-6 w-6 text-primary" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path fill-rule="evenodd" d="M5.625 1.5H9a3.75 3.75 0 013.75 3.75v1.875c0 1.036.84 1.875 1.875 1.875H16.5a3.75 3.75 0 013.75 3.75v7.875c0 1.035-.84 1.875-1.875 1.875H5.625a1.875 1.875 0 01-1.875-1.875V3.375c0-1.036.84-1.875 1.875-1.875zm6.905 9.97a.75.75 0 00-1.06 0l-3 3a.75.75 0 101.06 1.06l1.72-1.72V18a.75.75 0 001.5 0v-4.19l1.72 1.72a.75.75 0 101.06-1.06l-3-3z" clip-rule="evenodd" />
            <path d="M14.25 5.25a5.23 5.23 0 00-1.279-3.434 9.768 9.768 0 016.963 6.963A5.23 5.23 0 0016.5 7.5h-1.875a.375.375 0 01-.375-.375V5.25z" />
          </svg>
        </div>
        <h3 class="mt-4 text-xl font-extrabold">Pobierz pełny cennik PDF</h3>
        <p class="mx-auto mt-3 text-sm text-slate-600">
          Wszystkie warianty, pakiety i kursy grupowe w jednym dokumencie.
        </p>
        <div class="mt-6">
          <a
            class={`${btnPrimary} inline-flex items-center gap-2`}
            href="/cennik-lingua.pdf"
            download
          >
            <svg class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
              <path
                fill-rule="evenodd"
                d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z"
                clip-rule="evenodd"></path>
            </svg>
            Pobierz cennik (PDF)
          </a>
        </div>
      </div>
    </div>
  </section>

  <section class="py-16 lg:py-24">
    <div class="mx-auto w-full max-w-7xl px-6">
      <h2>Jak działa wycena</h2>
      <div class="mt-6 grid gap-6 md:grid-cols-3">
        {
          faq.map((item) => (
            <div class={`${card} p-6`}>
              <div class="text-sm font-extrabold text-slate-900">{item.question}</div>
              <p class="mt-3 text-sm text-slate-600">{item.answer}</p>
            </div>
          ))
        }
      </div>
      <p class="mt-6 text-xs text-slate-500">
        Cennik oparty o PDF na sezon 2025/2026. Jeśli potrzebujesz indywidualnej wyceny, skontaktuj
        się z nami.
      </p>
    </div>
  </section>

  <CTASection
    title="Chcesz dokładny plan i cenę dla siebie?"
    description="Napisz, jaki masz poziom, cel i preferowane godziny — przygotujemy propozycję pakietu."
  />
</MainLayout>
