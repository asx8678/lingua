---
import BaseLayout from "../layouts/BaseLayout.astro";

const languages = [
  "hiszpański",
  "angielski",
  "włoski",
  "francuski",
  "niemiecki",
  "szwedzki",
  "rosyjski",
];
---

<BaseLayout title="Zapisy 2025/2026 — Lingua Legionowo">
  <section class="hero-bg">
    <div class="container-site py-16 sm:py-20">
      <div class="grid gap-10 lg:grid-cols-2 lg:items-start">
        <div>
          <span class="kicker">ZAPISY 2025/2026</span>
          <h1 class="mt-6">Zapisz się na zajęcia</h1>
          <p class="mt-6 max-w-3xl text-lg">
            Wypełnij formularz, a wrócimy z propozycją terminu i dopasowaniem poziomu.
            Możesz też napisać bezpośrednio na
            <a href="mailto:lingualegionowo@gmail.com" class="font-extrabold text-primary no-underline">lingualegionowo@gmail.com</a>
            lub zadzwonić:
            <a href="tel:+48453209560" class="font-extrabold text-primary no-underline">+48 453 209 560</a>.
          </p>

          <div class="notice mt-8">
            <div class="font-extrabold text-slate-900">Co warto podać</div>
            <div class="mt-1 text-sm">
              język, poziom (jeśli znasz), cel nauki oraz preferowane dni/godziny.
            </div>
          </div>

          <div class="mt-8 flex flex-wrap gap-3">
            <a class="btn btn-secondary" href="/cennik-lingua.pdf" download>POBIERZ CENNIK</a>
            <a class="btn btn-ghost" href="/kontakt">Kontakt</a>
          </div>
        </div>

        <div class="card p-6">
          <h2 class="text-lg font-extrabold text-slate-900">Formularz zgłoszeniowy</h2>
          <p class="mt-2 text-sm text-slate-600">Pola oznaczone * są wymagane.</p>

          <form id="enroll-form" method="post" action="/api/zapisy" class="mt-6 space-y-4">
            <div>
              <label for="name" class="text-sm font-bold text-slate-900">Imię i nazwisko *</label>
              <input
                id="name"
                name="name"
                autocomplete="name"
                required
                class="mt-1 w-full rounded-xl border-slate-300 bg-white focus:border-primary focus:ring-primary"
              />
            </div>

            <div>
              <label for="email" class="text-sm font-bold text-slate-900">E-mail *</label>
              <input
                id="email"
                name="email"
                type="email"
                autocomplete="email"
                required
                class="mt-1 w-full rounded-xl border-slate-300 bg-white focus:border-primary focus:ring-primary"
              />
            </div>

            <div>
              <label for="phone" class="text-sm font-bold text-slate-900">Telefon (opcjonalnie)</label>
              <input
                id="phone"
                name="phone"
                type="tel"
                autocomplete="tel"
                class="mt-1 w-full rounded-xl border-slate-300 bg-white focus:border-primary focus:ring-primary"
              />
            </div>

            <div class="grid gap-4 sm:grid-cols-2">
              <div>
                <label for="language" class="text-sm font-bold text-slate-900">Język *</label>
                <select
                  id="language"
                  name="language"
                  required
                  class="mt-1 w-full rounded-xl border-slate-300 bg-white focus:border-primary focus:ring-primary"
                >
                  <option value="" selected disabled>Wybierz język</option>
                  {languages.map((l) => <option value={l}>{l}</option>)}
                </select>
              </div>

              <div>
                <label for="mode" class="text-sm font-bold text-slate-900">Rodzaj zajęć *</label>
                <select
                  id="mode"
                  name="mode"
                  required
                  class="mt-1 w-full rounded-xl border-slate-300 bg-white focus:border-primary focus:ring-primary"
                >
                  <option value="" selected disabled>Wybierz</option>
                  <option value="indywidualne">Indywidualne</option>
                  <option value="grupowe">Grupowe</option>
                </select>
              </div>
            </div>

            <div>
              <label for="message" class="text-sm font-bold text-slate-900">Wiadomość</label>
              <textarea
                id="message"
                name="message"
                class="mt-1 min-h-[120px] w-full rounded-xl border-slate-300 bg-white focus:border-primary focus:ring-primary"
                placeholder="Np. poziom, cel, preferowane dni/godziny…"
              ></textarea>
            </div>

            <button class="btn btn-primary w-full" type="submit">Wyślij zgłoszenie</button>

            <p id="form-result" class="text-sm"></p>

            <p class="text-xs text-slate-500">
              Dane z formularza wykorzystujemy wyłącznie do kontaktu w sprawie zapisów.
              <a class="font-bold text-primary no-underline hover:underline" href="/polityka-prywatnosci">Polityka prywatności</a>.
            </p>
          </form>

          <script is:inline>
            const form = document.getElementById("enroll-form");
            const out = document.getElementById("form-result");

            form?.addEventListener("submit", async (e) => {
              e.preventDefault();
              out.textContent = "Wysyłanie…";
              out.className = "text-sm text-slate-600";

              try {
                const fd = new FormData(form);
                const res = await fetch(form.action, { method: "POST", body: fd });
                const data = await res.json();

                if (!res.ok || !data?.ok) {
                  out.textContent = data?.error ? "Błąd: " + data.error : "Wystąpił błąd. Spróbuj ponownie.";
                  out.className = "text-sm text-red-600";
                  return;
                }

                out.textContent = "Dziękujemy! Zgłoszenie zostało przyjęte (demo).";
                out.className = "text-sm text-emerald-700";
                form.reset();
              } catch (err) {
                out.textContent = "Wystąpił błąd połączenia. Spróbuj ponownie.";
                out.className = "text-sm text-red-600";
              }
            });
          </script>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>
