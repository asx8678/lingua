---
import { PRICING_DATA, PRICING_SUMMARY, formatPLN } from "../data/pricing";

const defaultPlan = PRICING_DATA.packages.find((p) => p.id === "pakiet-45") ?? PRICING_DATA.packages[0];
const defaultPersons = 1;
const defaultSessions = defaultPlan.baseSessions;
const defaultPrice10 = defaultPlan.pricePerPerson[defaultPersons];
const defaultPerSession = defaultPrice10 / defaultPlan.baseSessions;
const defaultPerPersonTotal = defaultPerSession * defaultSessions;
const defaultGroupTotal = defaultPerPersonTotal * defaultPersons;
const defaultNote = `Pakiet ${defaultPlan.baseSessions} spotkań × ${defaultPlan.minutes} min: ${formatPLN(defaultPrice10)} / osoba (wg cennika).`;
---

<div class="card p-6">
  <div class="text-xs text-slate-600">
    {PRICING_SUMMARY.note}
  </div>
  <div class="mt-2 text-xs text-slate-600">
    {PRICING_SUMMARY.packages}
  </div>
  <div class="mt-2 text-xs text-slate-600">
    {PRICING_SUMMARY.courses}
  </div>

  <form id="price-calc" class="grid gap-4" aria-label="Kalkulator ceny">
    <div>
      <div class="text-sm font-bold text-slate-900">Typ</div>
      <div class="mt-2 grid gap-4 lg:grid-cols-2">
        <div>
          <div class="text-xs font-bold uppercase tracking-widest text-slate-500">Pakiety (10 spotkań)</div>
          <div class="mt-2 flex flex-wrap gap-2" role="group" aria-label="Pakiety">
            {PRICING_DATA.packages.map((p) => (
              <button
                type="button"
                class="btn btn-secondary px-4 py-2 text-xs"
                data-plan={p.id}
              >
                {p.label}
              </button>
            ))}
          </div>
        </div>
        <div>
          <div class="text-xs font-bold uppercase tracking-widest text-slate-500">Kursy (grupy)</div>
          <div class="mt-2 flex flex-wrap gap-2" role="group" aria-label="Kursy">
            {PRICING_DATA.courses.map((c) => (
              <button
                type="button"
                class="btn btn-secondary px-4 py-2 text-xs"
                data-plan={c.id}
              >
                {c.label}
              </button>
            ))}
          </div>
        </div>
      </div>
      <select id="plan" name="plan" class="sr-only" aria-hidden="true" tabindex="-1">
        <optgroup label="Pakiety (10 spotkań)">
          {PRICING_DATA.packages.map((p) => (
            <option value={p.id} selected={p.id === "pakiet-45"}>{p.label}</option>
          ))}
        </optgroup>
        <optgroup label="Kursy (grupy)">
          {PRICING_DATA.courses.map((c) => (
            <option value={c.id}>{c.label}</option>
          ))}
        </optgroup>
      </select>
    </div>

    <div class="grid gap-4 sm:grid-cols-2">
      <div>
        <label for="persons" class="text-sm font-bold text-slate-900">Liczba osób</label>
        <div class="mt-1 flex items-center gap-2">
          <button
            type="button"
            class="rounded-full border border-slate-200 bg-white px-3 py-2 text-sm font-bold text-slate-700 transition hover:bg-slate-100"
            data-target="persons"
            data-step="-1"
            aria-controls="persons"
            aria-label="Zmniejsz liczbę osób"
          >
            −
          </button>
          <input
            id="persons"
            name="persons"
            type="number"
            inputmode="numeric"
            min="1"
            max="3"
            value="1"
            aria-describedby="persons-hint"
            class="w-full rounded-xl border-slate-300 bg-white text-center focus:border-primary focus:ring-primary"
          />
          <button
            type="button"
            class="rounded-full border border-slate-200 bg-white px-3 py-2 text-sm font-bold text-slate-700 transition hover:bg-slate-100"
            data-target="persons"
            data-step="1"
            aria-controls="persons"
            aria-label="Zwiększ liczbę osób"
          >
            +
          </button>
        </div>
        <div class="mt-2 flex flex-wrap gap-2" role="group" aria-label="Szybki wybór liczby osób">
          {[1, 2, 3, 4].map((value) => (
            <button
              type="button"
              class="chip text-xs"
              data-preset="persons"
              data-value={value}
            >
              {value}
            </button>
          ))}
        </div>
        <p id="persons-hint" class="mt-1 text-xs text-slate-500"></p>
      </div>

      <div>
        <label for="sessions" class="text-sm font-bold text-slate-900">Liczba spotkań</label>
        <div class="mt-1 flex items-center gap-2">
          <button
            type="button"
            class="rounded-full border border-slate-200 bg-white px-3 py-2 text-sm font-bold text-slate-700 transition hover:bg-slate-100"
            data-target="sessions"
            data-step="-1"
            aria-controls="sessions"
            aria-label="Zmniejsz liczbę spotkań"
          >
            −
          </button>
          <input
            id="sessions"
            name="sessions"
            type="number"
            inputmode="numeric"
            min="1"
            max="200"
            value="10"
            aria-describedby="sessions-hint"
            class="w-full rounded-xl border-slate-300 bg-white text-center focus:border-primary focus:ring-primary"
          />
          <button
            type="button"
            class="rounded-full border border-slate-200 bg-white px-3 py-2 text-sm font-bold text-slate-700 transition hover:bg-slate-100"
            data-target="sessions"
            data-step="1"
            aria-controls="sessions"
            aria-label="Zwiększ liczbę spotkań"
          >
            +
          </button>
        </div>
        <div class="mt-2 flex flex-wrap gap-2" role="group" aria-label="Szybki wybór liczby spotkań">
          {[10, 20, 30].map((value) => (
            <button
              type="button"
              class="chip text-xs"
              data-preset="sessions"
              data-value={value}
            >
              {value}
            </button>
          ))}
        </div>
        <p id="sessions-hint" class="mt-1 text-xs text-slate-500"></p>
      </div>
    </div>
  </form>

  <div class="mt-6 rounded-2xl border border-slate-200 bg-slate-50 p-5" aria-live="polite">
    <div class="grid gap-4 sm:grid-cols-3 sm:items-end" role="status">
      <div>
        <div class="text-xs font-bold uppercase tracking-widest text-slate-500">Za spotkanie / osoba</div>
        <div id="out-per-session" class="mt-2 text-3xl font-extrabold text-slate-900">
          {formatPLN(defaultPerSession)}
        </div>
        <div id="out-per-session-sub" class="mt-1 text-xs text-slate-500">{defaultPlan.minutes} min</div>
      </div>

      <div>
        <div class="text-xs font-bold uppercase tracking-widest text-slate-500">Łącznie / osoba</div>
        <div id="out-per-total" class="mt-2 text-3xl font-extrabold text-slate-900">
          {formatPLN(defaultPerPersonTotal)}
        </div>
        <div id="out-per-total-sub" class="mt-1 text-xs text-slate-500">{defaultSessions} spotkań</div>
      </div>

      <div id="total-block">
        <div class="text-xs font-bold uppercase tracking-widest text-slate-500">Łącznie (grupa)</div>
        <div id="out-total" class="mt-2 text-3xl font-extrabold text-slate-900">
          {formatPLN(defaultGroupTotal)}
        </div>
        <div id="out-total-sub" class="mt-1 text-xs text-slate-500">{defaultPersons} os.</div>
      </div>
    </div>

    <div class="mt-4 flex items-center gap-2 text-xs text-slate-600">
      <input
        id="show-total"
        type="checkbox"
        checked
        class="h-4 w-4 rounded border-slate-300 text-primary focus:ring-primary"
      />
      <label for="show-total" class="select-none">Pokaż koszt dla całej grupy</label>
    </div>

    <div id="out-note" class="mt-4 text-xs text-slate-600">{defaultNote}</div>
  </div>

  <p class="mt-4 text-xs text-slate-500">
    Kalkulator bazuje na cenniku 2025/2026. W przypadku kursów liczba spotkań jest stała.
  </p>

  <script>
    import { PRICING_DATA } from "../data/pricing";
    import { initPriceCalculator } from "../scripts/price-calculator";

    initPriceCalculator(PRICING_DATA);
  </script>
</div>
