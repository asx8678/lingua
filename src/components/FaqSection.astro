---
export interface FaqItem {
  question: string;
  answer: string;
}

interface Props {
  title?: string;
  items?: FaqItem[];
  id?: string;
}

const { title = "FAQ", items = [], id } = Astro.props;

const jsonLd = {
  "@context": "https://schema.org",
  "@type": "FAQPage",
  mainEntity: items.map((item) => ({
    "@type": "Question",
    name: item.question,
    acceptedAnswer: {
      "@type": "Answer",
      text: item.answer,
    },
  })),
};

// Tailwind class constants
const card = "rounded-2xl border border-slate-100 bg-white transition-all duration-200 hover:border-slate-200";
---

<section class="py-20 lg:py-28 bg-slate-50/70" id={id}>
  <div class="mx-auto w-full max-w-7xl px-6">
    <h2>{title}</h2>
    <div class="mt-10 space-y-3" data-faq-container>
      {
        items.map((item) => (
          <details class={`${card} p-5 sm:p-6`} data-faq-item>
            <summary
              class="cursor-pointer text-sm font-semibold text-slate-900 list-none flex items-center justify-between gap-4"
              aria-expanded="false"
            >
              <span>{item.question}</span>
              <svg
                class="h-5 w-5 shrink-0 text-slate-300 transition-transform duration-300 ease-out"
                data-faq-icon
                viewBox="0 0 20 20"
                fill="currentColor"
                aria-hidden="true"
              >
                <path
                  fill-rule="evenodd"
                  d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
                  clip-rule="evenodd"
                />
              </svg>
            </summary>
            <p class="mt-4 text-sm text-slate-600 leading-relaxed">{item.answer}</p>
          </details>
        ))
      }
    </div>
  </div>
  <script is:inline type="application/ld+json" set:html={JSON.stringify(jsonLd)} />
</section>

<script is:inline>
  document.querySelectorAll("[data-faq-item]").forEach((details) => {
    const summary = details.querySelector("summary");
    const icon = details.querySelector("[data-faq-icon]");

    details.addEventListener("toggle", () => {
      const isOpen = details.open;
      summary?.setAttribute("aria-expanded", String(isOpen));
      if (icon) {
        icon.style.transform = isOpen ? "rotate(180deg)" : "";
      }
    });
  });
</script>
