---
import MainLayout from "../layouts/MainLayout.astro";
import CTASection from "./CTASection.astro";
import FaqSection from "./FaqSection.astro";
import {
  BRAND_NAME,
  CTA_PRIMARY_HREF,
  CTA_PRIMARY_LABEL,
  CTA_PRIMARY_REL,
  CTA_PRIMARY_TARGET,
  getSecondaryCta,
  type CtaVariant,
  generateBreadcrumbSchema,
  SITE_URL,
} from "../config/site";
import type { SubjectPageData } from "../data/subject-pages";

interface Props {
  data: SubjectPageData;
}

const { data } = Astro.props;
const fullTitle = `${data.title} | ${BRAND_NAME}`;
const ctaVariant: CtaVariant = data.slug === "matematyka" ? "math" : "language";
const secondaryCta = getSecondaryCta(ctaVariant);

const faqJsonLd = {
  "@context": "https://schema.org",
  "@type": "FAQPage",
  mainEntity: data.faqs.map((item) => ({
    "@type": "Question",
    name: item.question,
    acceptedAnswer: {
      "@type": "Answer",
      text: item.answer,
    },
  })),
};

const breadcrumbSchema = generateBreadcrumbSchema([
  { name: "Strona główna", url: "/" },
  { name: "Oferta", url: "/oferta" },
  { name: data.kicker },
]);

const courseJsonLd = {
  "@context": "https://schema.org",
  "@type": "Course",
  name: data.h1,
  description: data.description,
  provider: {
    "@type": "Organization",
    name: BRAND_NAME,
    url: SITE_URL,
  },
};

// Tailwind class constants
const btnBase = "inline-flex items-center justify-center gap-2 rounded-full px-6 py-3 text-sm font-bold transition-all duration-200 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary";
const btnPrimary = `${btnBase} bg-primary text-white shadow-md hover:bg-primary-700 hover:shadow-lg hover:-translate-y-0.5 active:translate-y-0 active:shadow-md`;
const btnSecondary = `${btnBase} border border-slate-200 bg-white text-slate-700 shadow-sm hover:border-primary/30 hover:text-primary hover:shadow-md hover:-translate-y-0.5 active:translate-y-0`;
const card = "rounded-2xl border border-slate-200/80 bg-white shadow-sm transition-shadow hover:shadow-md";
const kicker = "inline-block rounded-full bg-primary/10 px-4 py-1.5 text-xs font-bold uppercase tracking-widest text-primary";
---

<MainLayout
  title={fullTitle}
  description={data.description}
  canonical={`/${data.slug}`}
  structuredData={[faqJsonLd, breadcrumbSchema, courseJsonLd]}
>
  <section class="bg-hero-gradient">
    <div class="mx-auto w-full max-w-7xl px-6 py-16 sm:py-20">
      <div class="grid gap-10 lg:grid-cols-2 lg:items-start">
        <div>
          <span class={kicker}>{data.kicker}</span>
          <h1 class="mt-6">{data.h1}</h1>
          {data.intro.map((paragraph) => (
            <p class="mt-4 text-lg text-slate-600">{paragraph}</p>
          ))}
          <div class="mt-8 flex flex-wrap gap-3">
            <a
              class={btnPrimary}
              href={CTA_PRIMARY_HREF}
              target={CTA_PRIMARY_TARGET}
              rel={CTA_PRIMARY_REL}
              data-track="cta_primary"
              data-track-label={CTA_PRIMARY_LABEL}
            >
              {CTA_PRIMARY_LABEL}
            </a>
            {
              secondaryCta && (
                <a
                  class={btnSecondary}
                  href={secondaryCta.href}
                  data-track="cta_secondary"
                  data-track-label={secondaryCta.label}
                >
                  {secondaryCta.label}
                </a>
              )
            }
          </div>
          <p class="mt-4 text-sm text-slate-500">
            Sprawdź
            <a class="font-bold text-primary no-underline hover:underline" href="/cennik">cennik</a>
            lub napisz do nas przez
            <a class="font-bold text-primary no-underline hover:underline" href="/kontakt">formularz</a>.
          </p>
        </div>

        <div class={`${card} p-6`}>
          <h2 class="text-xl font-extrabold text-slate-900">Najważniejsze informacje</h2>
          <ul class="mt-4 space-y-3 text-sm text-slate-600">
            {data.highlights.map((item) => (
              <li class="flex items-start gap-2">
                <span class="mt-1.5 h-2 w-2 flex-shrink-0 rounded-full bg-primary" aria-hidden="true" />
                <span>{item}</span>
              </li>
            ))}
          </ul>
          <div class="mt-6 rounded-2xl border border-slate-200 bg-slate-50 p-4 text-sm text-slate-600">
            {data.pricingNote}
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="py-16 lg:py-24">
    <div class="mx-auto w-full max-w-7xl px-6">
      <h2>{data.audienceTitle}</h2>
      <p class="mt-4 max-w-3xl">{data.audienceIntro}</p>
      <div class="mt-8 grid gap-6 md:grid-cols-3">
        {data.audience.map((item) => (
          <div class={`${card} p-6`}>
            <h3 class="text-lg font-extrabold text-slate-900">{item.label}</h3>
            <p class="mt-3 text-sm text-slate-600">{item.description}</p>
          </div>
        ))}
      </div>
    </div>
  </section>

  <section class="py-16 lg:py-24 bg-slate-50">
    <div class="mx-auto w-full max-w-7xl px-6">
      <h2>{data.goalsTitle}</h2>
      <p class="mt-4 max-w-3xl">{data.goalsIntro}</p>
      <div class="mt-8 grid gap-6 md:grid-cols-2">
        <div class={`${card} p-6`}>
          <h3 class="text-lg font-extrabold text-slate-900">Najczęstsze cele</h3>
          <ul class="mt-4 list-disc space-y-2 pl-5 text-sm text-slate-600">
            {data.goals.map((item) => (
              <li>{item}</li>
            ))}
          </ul>
        </div>
        <div class={`${card} p-6`}>
          <h3 class="text-lg font-extrabold text-slate-900">Efekty, które zauważysz</h3>
          <ul class="mt-4 list-disc space-y-2 pl-5 text-sm text-slate-600">
            {data.outcomes.map((item) => (
              <li>{item}</li>
            ))}
          </ul>
        </div>
      </div>
    </div>
  </section>

  <section class="py-16 lg:py-24">
    <div class="mx-auto w-full max-w-7xl px-6">
      <h2>{data.formatTitle}</h2>
      <p class="mt-4 max-w-3xl">{data.formatIntro}</p>
      <div class="mt-8 grid gap-6 md:grid-cols-3">
        {data.formats.map((item) => (
          <div class={`${card} p-6`}>
            <h3 class="text-lg font-extrabold text-slate-900">{item.title}</h3>
            <p class="mt-3 text-sm text-slate-600">{item.text}</p>
          </div>
        ))}
      </div>
      <div class="mt-8 grid gap-6 lg:grid-cols-2">
        <div class={`${card} p-6`}>
          <h3 class="text-lg font-extrabold text-slate-900">Jak wygląda organizacja</h3>
          <ul class="mt-4 list-disc space-y-2 pl-5 text-sm text-slate-600">
            {data.organization.map((item) => (
              <li>{item}</li>
            ))}
          </ul>
        </div>
        <div class={`${card} p-6`}>
          <h3 class="text-lg font-extrabold text-slate-900">Materiały i wsparcie</h3>
          <p class="mt-3 text-sm text-slate-600">{data.materialsIntro}</p>
          <ul class="mt-4 list-disc space-y-2 pl-5 text-sm text-slate-600">
            {data.materials.map((item) => (
              <li>{item}</li>
            ))}
          </ul>
        </div>
      </div>
    </div>
  </section>

  <section class="py-16 lg:py-24 bg-slate-50">
    <div class="mx-auto w-full max-w-7xl px-6">
      <div class="grid gap-8 lg:grid-cols-2 lg:items-start">
        <div>
          <h2>{data.lessonPlanTitle}</h2>
          <p class="mt-4 max-w-2xl">{data.lessonPlanIntro}</p>
          <ol class="mt-6 list-decimal space-y-3 pl-5 text-sm text-slate-600">
            {data.lessonPlan.map((item) => (
              <li>{item}</li>
            ))}
          </ol>
        </div>
        <div class={`${card} p-6`}>
          <h3 class="text-lg font-extrabold text-slate-900">Feedback po lekcji</h3>
          <p class="mt-3 text-sm text-slate-600">{data.feedbackIntro}</p>
          <ul class="mt-4 list-disc space-y-2 pl-5 text-sm text-slate-600">
            {data.feedback.map((item) => (
              <li>{item}</li>
            ))}
          </ul>
          <div class="mt-6">
            <a class={btnSecondary} href="/kontakt">Zapytaj o dostępne terminy</a>
          </div>
        </div>
      </div>
    </div>
  </section>

  <FaqSection title={`${data.kicker} — pytania i odpowiedzi`} items={data.faqs} />

  <CTASection
    title={data.cta.title}
    description={data.cta.description}
    note={data.cta.note}
    variant={ctaVariant}
  />
</MainLayout>
